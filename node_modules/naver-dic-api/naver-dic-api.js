var xml2js = require('xml2js');
var parseString = new xml2js.Parser().parseString;
var http = require('http')
var apiKey = process.env.NAVER_API_KEY

var options = {
  host : 'openapi.naver.com',
  path : '/search?key=' + apiKey + '&target=encyc&start=1&display=1'
};

function dic(query, callback) {
  var queryString = require('querystring')

  var url = "http://openapi.naver.com/search?key=" + apiKey + '&query=' + encodeURIComponent(query) + "&target=encyc&start=1&display=1";

  http.get(url, function(res) {
    res.setEncoding('utf8');

    buffer = ''
    res.on('data', function(data) {
      buffer += data
    })
    res.on('error', function(err) {
      console.log(err)
    })
    res.on('end', function() {
      parseString(buffer, function(err, result) {
        var item = result.rss.channel[0].item;
        var link = item[0].link[0];

        callback(link);
      });
    })
  });
}

module.exports.dic = dic
